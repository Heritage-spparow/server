<%
const formatCurrency = (amount) => `₹${Number(amount || 0).toFixed(2)}`;
const formatDate = (date) => moment(date).format('MMM DD, YYYY');
%>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Order Confirmation – Heritage Sparrow</title>

<style>
  body {
    margin: 0;
    padding: 0;
    background: #0f0f12;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    color: #eaeaea;
  }

  .container {
    max-width: 620px;
    margin: 0 auto;
    padding: 24px;
  }

  .card {
    background: #151519;
    border-radius: 14px;
    padding: 28px;
    box-shadow: 0 0 0 1px rgba(255,255,255,0.05);
  }

  .brand {
    font-size: 20px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #d8c37a;
  }

  .muted {
    color: #9a9a9a;
    font-size: 14px;
  }

  .title {
    font-size: 26px;
    margin: 14px 0 8px;
    font-weight: 500;
  }

  .btn {
    display: inline-block;
    margin: 24px 0;
    background: #4c8ec2;
    color: #fff;
    text-decoration: none;
    padding: 14px 22px;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 500;
    text-align: center;
  }

  .divider {
    height: 1px;
    background: rgba(255,255,255,0.08);
    margin: 24px 0;
  }

  .row {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 6px;
    font-size: 14px;
  }

  .section-title {
    margin: 32px 0 14px;
    font-size: 18px;
    font-weight: 500;
  }

  .product {
    display: flex;
    gap: 14px;
    margin-bottom: 14px;
  }

  .product img {
    width: 56px;
    height: 56px;
    border-radius: 8px;
    object-fit: cover;
    background: #222;
  }

  .product-name {
    font-size: 14px;
    line-height: 1.4;
  }

  .price {
    font-size: 14px;
    white-space: nowrap;
  }

  .total {
    font-size: 22px;
    font-weight: 600;
    margin-top: 8px;
  }

  .footer {
    text-align: center;
    margin-top: 32px;
    font-size: 13px;
    color: #8c8c8c;
  }

  @media (max-width: 480px) {
    .card {
      padding: 20px;
    }

    .title {
      font-size: 22px;
    }
  }
</style>
</head>

<body>
  <div class="container">
    <div class="card">

      <!-- BRAND -->
      <div class="brand">HERITAGE SPARROW</div>
      <div class="muted">Order #<%= order.orderNumber %></div>

      <!-- TITLE -->
      <div class="title">Thank you for your purchase!</div>
      <p class="muted">
        We’re getting your order ready to be shipped. You’ll be notified once it’s on the way.
      </p>

      <!-- CTA -->
      <a href="https://www.heritagesparrow.com/orders" class="btn">
        View your order
      </a>

      <!-- META -->
      <div class="row">
        <span class="muted">Order Date</span>
        <span><%= formatDate(order.createdAt) %></span>
      </div>
      <div class="row">
        <span class="muted">Payment Method</span>
        <span><%= order.paymentMethod === "razorpay" ? "Online Payment" : "Cash on Delivery" %></span>
      </div>

      <div class="divider"></div>

      <!-- ORDER SUMMARY -->
      <div class="section-title">Order summary</div>

      <% order.orderItems.forEach(item => { %>
        <div class="product">
          <img src="<%= item.image %>" alt="<%= item.name %>" />
          <div style="flex:1">
            <div class="product-name">
              <%= item.name %> × <%= item.quantity %>
            </div>
          </div>
          <div class="price">
            <%= formatCurrency(item.price * item.quantity) %>
          </div>
        </div>
      <% }) %>

      <div class="divider"></div>

      <!-- TOTALS -->
      <div class="row">
        <span class="muted">Subtotal</span>
        <span><%= formatCurrency(order.itemsPrice) %></span>
      </div>
      <div class="row">
        <span class="muted">Shipping</span>
        <span><%= formatCurrency(order.shippingPrice) %></span>
      </div>
      <div class="row">
        <span class="muted">Taxes</span>
        <span><%= formatCurrency(order.taxPrice) %></span>
      </div>

      <div class="row total">
        <span>Total</span>
        <span><%= formatCurrency(order.totalPrice) %></span>
      </div>

      <div class="divider"></div>

      <!-- CUSTOMER INFO -->
      <div class="section-title">Customer information</div>

      <p class="muted">
        <strong>Shipping address</strong><br />
        <%= user.firstName %> <%= user.lastName %><br />
        <%= order.shippingAddress.address %><br />
        <%= order.shippingAddress.city %>, <%= order.shippingAddress.state %> <%= order.shippingAddress.postalCode %><br />
        <%= order.shippingAddress.country %>
      </p>

      <p class="muted">
        <strong>Shipping method</strong><br />
        Free Shipping
      </p>

      <!-- FOOTER -->
      <div class="footer">
        If you have any questions, reply to this email or contact us at  
        <strong>support@heritagesparrow.com</strong>
      </div>

    </div>
  </div>
</body>
</html>
