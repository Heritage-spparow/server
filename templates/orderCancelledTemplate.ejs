<%
const formatCurrency = (amount) => `₹${Number(amount || 0).toFixed(2)}`;
const formatDate = (date) => moment(date).format('MMM DD, YYYY');
%>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Order Cancelled – Heritage Sparrow</title>

<style>
  body {
    margin: 0;
    padding: 0;
    background-color: #f6f4ec;
    font-family: Arial, Helvetica, sans-serif;
    color: #2b2b2b;
  }

  .wrapper {
    width: 96%;
    padding: 30px 12px;
  }

  .container {
    max-width: 640px;
    margin: 0 auto;
    background: #ffffff;
    border-radius: 12px;
    border: 1px solid #e6e6e6;
    overflow: hidden;
  }

  .header {
    padding: 26px 24px;
    text-align: center;
    border-bottom: 1px solid #eee;
  }

  .brand {
    font-size: 18px;
    letter-spacing: 0.12em;
    font-weight: 600;
  }

  .order-title {
    margin-top: 16px;
    font-size: 16px;
    font-weight: 600;
  }

  .subtext {
    margin-top: 8px;
    font-size: 14px;
    color: #666;
  }

  .section {
    padding: 22px 24px;
  }

  .section-title {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 14px;
  }

  .product-box {
    border: 1px solid #e6e6e6;
    border-radius: 10px;
    padding: 14px;
    display: table;
    width: 95%;
  }

  .product-img {
    width: 90px;
    vertical-align: top;
  }

  .product-img img {
    width: 90px;
    height: auto;
    border-radius: 8px;
  }

  .product-details {
    padding-left: 14px;
    vertical-align: top;
  }

  .product-name {
    font-size: 14px;
    font-weight: 600;
  }

  .product-meta {
    font-size: 13px;
    color: #666;
    margin-top: 4px;
  }

  .price {
    text-align: right;
    font-size: 14px;
    font-weight: 600;
    white-space: nowrap;
  }

  .row {
    display: table;
    width: 100%;
    font-size: 14px;
    margin-bottom: 6px;
  }

  .row span {
    display: table-cell;
  }

  .row span:last-child {
    text-align: right;
  }

  .divider {
    height: 1px;
    background: #eee;
    margin: 18px 0;
  }

  .two-col {
    display: table;
    width: 100%;
  }

  .col {
    display: table-cell;
    width: 50%;
    font-size: 13px;
    vertical-align: top;
  }

  .col strong {
    display: block;
    margin-bottom: 6px;
  }

  .btn {
    display: inline-block;
    margin-top: 22px;
    background: #8a3c3c;
    color: #ffffff;
    text-decoration: none;
    padding: 12px 22px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
  }

  .footer {
    text-align: center;
    padding: 18px;
    font-size: 12px;
    color: #777;
    background: #fafafa;
  }
</style>
</head>

<body>
  <div class="wrapper">
    <div class="container">

      <!-- HEADER -->
      <div class="header">
        <div class="brand">HERITAGE SPARROW</div>
        <div class="order-title">ORDER CANCELLED</div>
        <p class="subtext">
          <%= user.firstName %>, your order has been successfully cancelled.
        </p>
      </div>

      <!-- ORDER META -->
      <div class="section">
        <div class="row">
          <span>Order number</span>
          <span>#<%= order.orderNumber %></span>
        </div>
        <div class="row">
          <span>Order date</span>
          <span><%= formatDate(order.createdAt) %></span>
        </div>
        <div class="row">
          <span>Order status</span>
          <span>Cancelled</span>
        </div>
      </div>

      <!-- PRODUCT SUMMARY -->
      <div class="section">
        <div class="section-title">Cancelled items</div>

        <% order.orderItems.forEach(item => { %>
          <div class="product-box">
            <div style="display: table-cell" class="product-img">
              <img src="<%= item.image %>" alt="<%= item.name %>" />
            </div>
            <div style="display: table-cell" class="product-details">
              <div class="product-name"><%= item.name %></div>
              <div class="product-meta">
                Quantity: <%= item.quantity %>
              </div>
            </div>
            <div style="display: table-cell" class="price">
              <%= formatCurrency(item.price * item.quantity) %>
            </div>
          </div>
        <% }) %>
      </div>

      <!-- REFUND INFO -->
      <div class="section">
        <div class="section-title">Refund information</div>

        <p style="font-size: 14px; color: #555; line-height: 1.6;">
          <% if (order.paymentMethod === "razorpay") { %>
            Your payment of <strong><%= formatCurrency(order.totalPrice) %></strong>
            has been received and the refund (if applicable) will be processed to
            your original payment method within <strong>5–7 business days</strong>.
          <% } else { %>
            Since this was a Cash on Delivery order, no payment was charged.
          <% } %>
        </p>

        <a href="https://www.heritagesparrow.com/orders" class="btn">
          View orders
        </a>
      </div>

      <!-- ADDRESS -->
      <div class="section">
        <div class="two-col">
          <div class="col">
            <strong>Shipping address</strong>
            <%= user.firstName %> <%= user.lastName %><br />
            <%= order.shippingAddress.address %><br />
            <%= order.shippingAddress.city %>, <%= order.shippingAddress.state %>
            <%= order.shippingAddress.postalCode %><br />
            <%= order.shippingAddress.country %>
          </div>

          <div class="col">
            <strong>Need help?</strong>
            support@heritagesparrow.com
          </div>
        </div>
      </div>

      <!-- FOOTER -->
      <div class="footer">
        If you have any questions, reply to this email or contact
        <strong>support@heritagesparrow.com</strong>
      </div>

    </div>
  </div>
</body>
</html>
