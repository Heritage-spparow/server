<% const formatCurrency = (amount) => `â‚¹${Number(amount || 0).toFixed(2)}`;
const formatDate = (date) => moment(date).format('MMM DD, YYYY'); %>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order Confirmation â€“ Heritage Sparrow</title>

    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #f6f4ec;
        font-family: D-DIN, Arial, Helvetica, sans-serif;
        color: #2b2b2b;
      }

      .wrapper {
        width: 93%;
        padding: 30px 12px;
      }

      .container {
        max-width: 640px;
        margin: 0 auto;
        background: #ffffff;
        border-radius: 12px;
        border: 1px solid #e6e6e6;
        overflow: hidden;
      }

      .header {
        padding: 26px 24px;
        text-align: center;
        border-bottom: 1px solid #eee;
      }

      .brand {
        font-size: 18px;
        letter-spacing: 0.12em;
        font-weight: 600;
      }

      .order-title {
        margin-top: 16px;
        font-size: 16px;
        font-weight: 600;
      }

      .subtext {
        margin-top: 8px;
        font-size: 14px;
        color: #666;
      }

      .section {
        padding: 22px 24px;
      }

      .row {
        display: table;
        width: 100%;
        font-size: 14px;
        margin-bottom: 6px;
      }

      .row span {
        display: table-cell;
      }

      .row span:last-child {
        text-align: right;
      }

      .section-title {
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 14px;
      }

      .product-box {
        border: 1px solid #e6e6e6;
        border-radius: 10px;
        padding: 14px;
        display: table;
        width: 95%;
        margin-bottom: 10px;
      }

      .product-img {
        width: 90px;
        display: table-cell;
        vertical-align: top;
      }

      .product-img img {
        width: 90px;
        border-radius: 8px;
      }

      .product-details {
        display: table-cell;
        padding-left: 14px;
        vertical-align: top;
      }

      .product-name {
        font-size: 14px;
        font-weight: 600;
      }

      .product-meta {
        font-size: 13px;
        color: #666;
        margin-top: 4px;
      }

      .price {
        display: table-cell;
        text-align: right;
        font-size: 14px;
        font-weight: 600;
        white-space: nowrap;
        vertical-align: top;
      }

      .divider {
        height: 1px;
        background: #eee;
        margin: 18px 0;
      }

      .total {
        font-size: 18px;
        font-weight: 700;
      }

      .btn {
        display: inline-block;
        margin-top: 22px;
        background: #5a8f3c;
        color: #ffffff;
        text-decoration: none;
        padding: 12px 22px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
      }

      /* STATUS BAR */
      .status-wrapper {
        margin-top: 24px;
      }

      .status-track {
        display: table;
        background: #fafafa;
        border: 1px solid #e6e6e6;
        border-radius: 4px;
        padding: 8px 14px;
        width: 100%;
        margin-left: -14px;
      }

      .status-step {
        display: table-cell;
        text-align: center;
        padding: 0 10px;
        font-size: 11px;
        color: #b5b5b5;
      }

      .status-step.active {
        color: #5a8f3c;
        font-weight: 600;
      }

      .status-icon {
        display: block;
        font-size: 14px;
        margin-bottom: 4px;
      }

      .brand-signoff {
        display: table;
        width: 100%;
        margin-top: 18px;
      }

      .logo-cell {
        display: table-cell;
        text-align: right;
        vertical-align: middle;
      }

      .logo-cell img {
        max-width: 90px;
        opacity: 0.85;
      }

      .two-col {
        display: table;
        width: 100%;
      }

      .col {
        display: table-cell;
        width: 50%;
        font-size: 13px;
        vertical-align: top;
      }

      .footer {
        text-align: center;
        padding: 18px;
        font-size: 12px;
        color: #777;
        background: #fafafa;
      }
    </style>
  </head>

  <body>
    <div class="wrapper">
      <div class="container">
        <!-- HEADER -->
        <div class="header">
          <div class="brand">HERITAGE SPARROW</div>
          <div class="order-title">ORDER CONFIRMATION</div>
          <p class="subtext">
            <%= user.firstName %>, thank you for your order! Weâ€™ll notify you
            once your package is shipped.
          </p>
        </div>

        <!-- ORDER META -->
        <div class="section">
          <div class="row">
            <span>Order number</span>
            <span>#<%= order.orderNumber %></span>
          </div>
          <div class="row">
            <span>Order date</span>
            <span><%= formatDate(order.createdAt) %></span>
          </div>
          <div class="row">
            <span>Payment method</span>
            <span>
              <%= order.paymentMethod === "razorpay" 
               ? "Paid" 
               : "Cash on Delivery" %>
            </span>
          </div>
        </div>

        <!-- PRODUCTS -->
        <div class="section">
          <div class="section-title">Order summary</div>

          <% order.orderItems.forEach(item => { %>
          <div class="product-box">
            <div class="product-img">
              <img src="<%= item.image %>" alt="<%= item.name %>" />
            </div>
            <div class="product-details">
              <div class="product-name"><%= item.name %></div>
              <div class="product-meta">Quantity: <%= item.quantity %></div>
            </div>
            <div class="price">
              <%= formatCurrency(item.price * item.quantity) %>
            </div>
          </div>
          <% }) %>
        </div>

        <!-- TOTALS -->
        <div class="section">
          <div class="row">
            <span>Subtotal</span>
            <span><%= formatCurrency(order.itemsPrice) %></span>
          </div>
          <div class="row">
            <span>Shipping</span>
            <span><%= formatCurrency(order.shippingPrice) %></span>
          </div>
          <div class="row">
            <span>Taxes</span>
            <span>All taxes are inclusive</span>
          </div>

          <div class="divider"></div>

          <div class="row total">
            <span>Total</span>
            <span><%= formatCurrency(order.totalPrice) %></span>
          </div>

          <a
            href="https://www.heritagesparrow.com/order/<%= order._id %>"
            class="btn"
          >
            View order
          </a>

          <!-- STATUS BAR -->
          <div class="status-wrapper">
            <div class="status-track">
              <div
                class="status-step <%= ['confirmed','shipped','delivered'].indexOf(order.status) !== -1 ? 'active' : '' %>"
              >
                <span class="status-icon">ðŸ“¦</span>
                CONFIRMED
              </div>
              <div
                class="status-step <%= ['shipped','delivered'].indexOf(order.status) !== -1 ? 'active' : '' %>"
              >
                <span class="status-icon">ðŸšš</span>
                SHIPPED
              </div>
              <div
                class="status-step <%= order.status === 'delivered' ? 'active' : '' %>"
              >
                <span class="status-icon">âœ“</span>
                DELIVERED
              </div>
            </div>
          </div>
        </div>

        <!-- ADDRESS -->
        <div class="section">
          <div class="two-col">
            <div class="col">
              <strong>Shipping address</strong><br />
              <%= user.firstName %> <%= user.lastName %><br />
              <%= order.shippingAddress.address %><br />
              <%= order.shippingAddress.city %>, <%= order.shippingAddress.state
              %> <%= order.shippingAddress.postalCode %><br />
              <%= order.shippingAddress.country %>
            </div>

            <div class="col">
              <strong>Shipping method</strong><br />
              Free Shipping
            </div>
            <div class="brand-signoff">
              <div class="logo-cell">
                <img
                  src="https://res.cloudinary.com/drcy8edfo/image/upload/v1767868958/heitageSparrow_ytb6xw.png"
                  alt="Heritage Sparrow"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
          Need help? Contact us at <strong>support@heritagesparrow.com</strong>
        </div>
      </div>
    </div>
  </body>
</html>
